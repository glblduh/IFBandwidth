<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>WebMonitor</title>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            socket.on("connect", () => {
                // Auth client to server
                socket.emit("auth", "webmonitordefaultkey");
            });
            // Initiate the databuf event listener
            socket.on("databuf", data => {
                let table = document.getElementById("traftable");
                // Removes previous data on table
                while (table.firstChild) {
                    table.removeChild(table.lastChild);
                }
                //Makes the header of the table
                let tr1 = document.createElement("tr");
                let saddrtd = document.createElement("td");
                saddrtd.innerText = "Source";
                saddrtd.style.setProperty("color", "palegreen");
                let sporttd = document.createElement("td");
                sporttd.innerText = "Source Port";
                sporttd.style.setProperty("color", "palegreen");
                let daddrtd = document.createElement("td");
                daddrtd.innerText = "Destination";
                daddrtd.style.setProperty("color", "tomato");
                let dporttd = document.createElement("td");
                dporttd.innerText = "Destination Port";
                dporttd.style.setProperty("color", "tomato");
                let prototd = document.createElement("td");
                prototd.innerText = "Protocol";
                prototd.style.setProperty("color", "paleturquoise");
                let sizetd = document.createElement("td");
                sizetd.innerText = "Size";
                sizetd.style.setProperty("color", "violet");
                tr1.appendChild(saddrtd);
                tr1.appendChild(sporttd);
                tr1.appendChild(daddrtd);
                tr1.appendChild(dporttd);
                tr1.appendChild(prototd);
                tr1.appendChild(sizetd);
                table.appendChild(tr1);
                // Loops through databuf array and makes rows according to data
                for(let i=0;i<data.data.length;i++) {
                    document.getElementById("totalband").innerText = ((data.size / 1000) / 1000).toFixed(2);
                    let tr = document.createElement("tr");
                    let std = document.createElement("td");
                    std.innerText = data.data[i].shost;
                    std.style.setProperty("color", "palegreen");
                    let sptd = document.createElement("td");
                    sptd.innerText = data.data[i].sport;
                    sptd.style.setProperty("color", "palegreen");
                    let dtd = document.createElement("td");
                    dtd.innerText = data.data[i].dhost;
                    dtd.style.setProperty("color", "tomato");
                    let dptd = document.createElement("td");
                    dptd.innerText = data.data[i].dport;
                    dptd.style.setProperty("color", "tomato");
                    let protd = document.createElement("td");
                    protd.innerText = function(proto){switch(proto){case 6: {return "TCP"; break;}; case 17: {return "UDP"; break;}; default: {return proto;};}}(data.data[i].proto);
                    protd.style.setProperty("color", "paleturquoise");
                    let sitd = document.createElement("td");
                    sitd.innerText = data.data[i].size / 1000 + "KB";
                    sitd.style.setProperty("color", "violet");
                    tr.appendChild(std);
                    tr.appendChild(sptd);
                    tr.appendChild(dtd);
                    tr.appendChild(dptd);
                    tr.appendChild(protd);
                    tr.appendChild(sitd);
                    table.appendChild(tr);
                }
            });
        </script>
        <style>
            body {
                background-color: #141414;
                color: white;
                text-align: center;
                font-family: monospace;
            }
            table {
                margin-left: auto;
                margin-right: auto;
                text-align: center;
            }
            td {
                border-left: 1px;
                border-left-color: transparent;
                border-left-style: solid;
                border-right: 1px;
                border-right-color: transparent;
                border-right-style: solid;
            }
            #totalband {
                color:palevioletred;
            }
        </style>
    </head>
    <body>
        <h1>WebMonitor</h1>
        <p>Total bandwidth: <span id=totalband>0</span>MB</p>
        <table id="traftable"></table>
    </body>
</html>